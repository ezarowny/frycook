

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Intro &mdash; Frycook 0.3.7 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.3.7',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Frycook 0.3.7 documentation" href="index.html" />
    <link rel="next" title="Intro" href="tutorial.html" />
    <link rel="prev" title="Welcome to Frycook!" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="tutorial.html" title="Intro"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Welcome to Frycook!"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Frycook 0.3.7 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="intro">
<h1>Intro<a class="headerlink" href="#intro" title="Permalink to this headline">¶</a></h1>
<p>Frycook is a system for installing and maintaining software on Linux
computers.  It consists of a framework to build systems with and a
program you run to apply the things you built with the framework to your
computers.</p>
<p>At the highest level Frycook depends on recipes and cookbooks to define
how systems are built.  Recipes and cookbooks in turn use settings,
environments, and packages to do their work.  The settings and
environments are passed around within the framework as json-translatable
dictionaries.  Packages live on disk as directories and files.</p>
<p>Settings and environments exist as json-like dictionaries because they
are easy to turn into json files, and then read back from them, and
because most templating engines expect dictionaries to be passed to them
in order to render their contents.  This means that these dictionaries
map nicely to both the storage and rendering functions and keep frycook
simple.</p>
<p>Recipes and cookbooks are python code that get executed when building
and updating servers.  Each recipe and cookbook lives in its own file.</p>
</div>
<div class="section" id="setup">
<h1>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h1>
<p>Before you can do anything with frycook, you&#8217;ll need to install its
python package from pypi.  I usually create a virtualenv to run it in,
but it can also be installed globally:</p>
<div class="highlight-python"><pre>$ pip install frycook</pre>
</div>
</div>
<div class="section" id="globules">
<h1>Globules<a class="headerlink" href="#globules" title="Permalink to this headline">¶</a></h1>
<p>All the user-generated files necessary for frycook to function are
usually arranged in a directory structure that I call a <em>globule</em>.  The
rest of these instructions will walk you through this globule and
explain all the pieces and how they work together.</p>
<p>Here&#8217;s an example globule:</p>
<div class="highlight-python"><pre>sample                     # root directory
  packages                 # directory for the package files
    example_com            # root for example_com package files
      etc                  # corresponds to /etc on the target server
        nginx              # corresponds to /etc/nginx on the target server
          sites-available  # corresponds to /etc/nginx/sites-available on the target server
            example.com    # corresponds to /etc/nginx/sites-available/example.com on the target server
    hosts                  # root for hosts package files
      etc                  # corresponds to /etc on the target server
        hostname.tmplt     # template that becomes /etc/hostname on the target server
        hosts.tmplt        # template that becomes /etc/hosts on the target server
    nginx                  # root for nginx package files
      etc                  # corresponds to /etc directory on the target server
        default            # corresponds to /etc/default directory on the target server
          nginx            # corresponds to /etc/default/nginx file on the target server
        nginx              # corresponds to /etc/nginx directory on target server
          nginx.conf       # corresponds to /etc/nginx/nginx.conf file on target server
          sites-available  # corresponds to /etc/nginx/sites-available directory on target server
            default        # corresponds to /etc/nginx/sites-available/default directory on target server
            fck_delete.txt # lists files to delete from /etc/nginx/sites-available on target server
      srv                  # corresponds to /srv directory on the target server
        www                # corresponds to /srv/www directory on the target server
          50x.html         # corresponds to /srv/www/50x.html file on target server
          index.html       # corresponds to /srv/www/index.html file on target server
    postfix                # root for postfix package files
      etc                  # corresponds to /etc directory on the target server
        aliases            # corresponds to /etc/aliases directory on the target server
        mailname.tmplt     # template that becomes /etc/mailname on the target server
        postfix            # corresponds to /etc/postfix directory on the target server
          main.cf.tmplt    # template that becomes /etc/postfix/main.cf on the target server
    shorewall              # root for shorewall package files
      etc                  # corresponds to /etc directory on the target server
        default            # corresponds to /etc/default directory on the target server
          shorewall        # corresponds to /etc/default/shorewall directory on the target server
        shorewall          # corresponds to /etc/shorewall directory on the target server
          interfaces.tmplt # template that becomes /etc/shorewall/interfaces on the target server
    ssh                    # root for ssh package files
      etc                  # corresponds to /etc directory on the target server
        ssh                # corresponds to /etc/ssh directory on the target server
          sshd_config      # corresponds to /etc/ssh/sshd_config directory on the target server
  setup                    # directory for non-package files
    comp_dev.json          # included environment file for computer named dev
    environment.json       # environment file
    requirements.txt       # python pip requirements file
    runner.sh              # wrapper for frycooker.py that sets PYTHONPATH
    settings.json          # settings file
    cookbooks              # directory to hold the cookbooks package
      __init__.py          # define the cookbook list here and import all cookbook classes
      base.py              # cookbook referencing all the recipes for a base server setup
      web.py               # cookbook for make a base server into a web server
    recipes                # directory to hold the recipes package
      __init__.py          # define the recipe list here and import all recipe classes
      example_com.py       # recipe for setting up example.com on a web server
      fail2ban.py          # recipe for setting up fail2ban
      hosts.py             # recipe for setting up the /etc/hosts file
      nginx.py             # recipe for setting up nginx
      postfix.py           # recipe for setting up postfix
      root_user.py         # recipe for setting the root user's authorized_keys file
      shorewall.py         # recipe for setting up shorewall
      ssh.py               # recipe for setting up ssh</pre>
</div>
</div>
<div class="section" id="recipes">
<h1>Recipes<a class="headerlink" href="#recipes" title="Permalink to this headline">¶</a></h1>
<p>Recipes define subsystems that are distinct parts of larger systems.
They are the basic units of setup in frycook.  Generally a recipe
corresponds to an os-level package that needs to be installed or configured.</p>
<div class="section" id="example-recipe">
<h2>example recipe<a class="headerlink" href="#example-recipe" title="Permalink to this headline">¶</a></h2>
<p>This example sets up the hosts file on a computer:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">cuisine</span>

<span class="kn">from</span> <span class="nn">frycook</span> <span class="kn">import</span> <span class="n">Recipe</span>


<span class="k">class</span> <span class="nc">RecipeHosts</span><span class="p">(</span><span class="n">Recipe</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">computer</span><span class="p">):</span>
        <span class="n">group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="p">[</span><span class="s">&quot;computers&quot;</span><span class="p">][</span><span class="n">computer</span><span class="p">][</span><span class="s">&quot;host_group&quot;</span><span class="p">]</span>
        <span class="n">computers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="p">[</span><span class="s">&quot;groups&quot;</span><span class="p">][</span><span class="n">group</span><span class="p">][</span><span class="s">&quot;computers&quot;</span><span class="p">]</span>
        <span class="n">sibs</span> <span class="o">=</span> <span class="p">[</span><span class="n">comp</span> <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">computers</span> <span class="k">if</span> <span class="n">comp</span> <span class="o">!=</span> <span class="n">computer</span><span class="p">]</span>
        <span class="n">tmp_env</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;host&quot;</span><span class="p">:</span> <span class="n">computer</span><span class="p">,</span>
                   <span class="s">&quot;sibs&quot;</span><span class="p">:</span> <span class="n">sibs</span><span class="p">,</span>
                   <span class="s">&quot;computers&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="p">[</span><span class="s">&quot;computers&quot;</span><span class="p">]}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_package_file_set</span><span class="p">(</span><span class="s">&#39;hosts&#39;</span><span class="p">,</span> <span class="n">computer</span><span class="p">,</span> <span class="n">tmp_env</span><span class="p">)</span>

        <span class="n">cuisine</span><span class="o">.</span><span class="n">sudo</span><span class="p">(</span><span class="s">&quot;service hostname restart&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="recipe-list">
<h2>recipe list<a class="headerlink" href="#recipe-list" title="Permalink to this headline">¶</a></h2>
<p>There should be a recipe list in the <tt class="docutils literal"><span class="pre">__init__.py</span></tt> file for the packge.
This lists all the avilable recipes that cookbooks and frycooker.py can
reference.</p>
<p>Here&#8217;s the sample <tt class="docutils literal"><span class="pre">__init__.py</span></tt> file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">fail2ban</span> <span class="kn">import</span> <span class="n">RecipeFail2ban</span>
<span class="kn">from</span> <span class="nn">hosts</span> <span class="kn">import</span> <span class="n">RecipeHosts</span>
<span class="kn">from</span> <span class="nn">nginx</span> <span class="kn">import</span> <span class="n">RecipeNginx</span>
<span class="kn">from</span> <span class="nn">postfix</span> <span class="kn">import</span> <span class="n">RecipePostfix</span>
<span class="kn">from</span> <span class="nn">root_user</span> <span class="kn">import</span> <span class="n">RecipeRootUser</span>
<span class="kn">from</span> <span class="nn">example_com</span> <span class="kn">import</span> <span class="n">RecipeExampleCom</span>
<span class="kn">from</span> <span class="nn">shorewall</span> <span class="kn">import</span> <span class="n">RecipeShorewall</span>
<span class="kn">from</span> <span class="nn">ssh</span> <span class="kn">import</span> <span class="n">RecipeSSH</span>

<span class="n">recipes</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;fail2ban&#39;</span><span class="p">:</span> <span class="n">RecipeFail2ban</span><span class="p">,</span>
    <span class="s">&#39;hosts&#39;</span><span class="p">:</span> <span class="n">RecipeHosts</span><span class="p">,</span>
    <span class="s">&#39;nginx&#39;</span><span class="p">:</span> <span class="n">RecipeNginx</span><span class="p">,</span>
    <span class="s">&#39;postfix&#39;</span><span class="p">:</span> <span class="n">RecipePostfix</span><span class="p">,</span>
    <span class="s">&#39;root_user&#39;</span><span class="p">:</span> <span class="n">RecipeRootUser</span><span class="p">,</span>
    <span class="s">&#39;example_com&#39;</span><span class="p">:</span> <span class="n">RecipeExampleCom</span><span class="p">,</span>
    <span class="s">&#39;shorewall&#39;</span><span class="p">:</span> <span class="n">RecipeShorewall</span><span class="p">,</span>
    <span class="s">&#39;ssh&#39;</span><span class="p">:</span> <span class="n">RecipeSSH</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="idempotence">
<h2>idempotence<a class="headerlink" href="#idempotence" title="Permalink to this headline">¶</a></h2>
<p>One thing to keep in mind when creating recipes and cookbooks is
idempotency.  By keeping idempotency in mind in general you can create
recipes that you can run again and again to push out minor changes to a
package.  This way your recipes become the only way that you modify your
servers and can be a single chokepoint that you can monitor to make sure
things happen properly.</p>
<p>Lots of the cuisine functions you&#8217;ll use have an &#8220;ensure&#8221; version that
first checks to see if a condition is true before applying it, such as
checking if a package is installed before trying to install it.  This is
nice when things could cause undesired configuration changes or
expensive operations that you don&#8217;t want to happen every time.  These
functions are a huge aid in writing idempotent recipes and cookbooks.</p>
</div>
<div class="section" id="rudeness">
<h2>rudeness<a class="headerlink" href="#rudeness" title="Permalink to this headline">¶</a></h2>
<p>Another thing to keep in mind is that some actions performed in recipes
can affect the end users of the systems, in effect being rude to them.
This might cause an outage or otherwise mess them up.  The recipe class
keeps track of whether or not this is ok in its <tt class="docutils literal"><span class="pre">ok_to_be_rude</span></tt> variable
so you can know what actions are acceptable.  Consult this before doing
rude things.</p>
</div>
<div class="section" id="file-set-copying">
<h2>file set copying<a class="headerlink" href="#file-set-copying" title="Permalink to this headline">¶</a></h2>
<p>The Recipe class defines a few helper functions for handling templates
and copying files to servers.  This is the primary way that recipes
interact with packages. They use the file set functions to copy the
package files and directories to the target server, processing their
contents in the process.</p>
<p>The routines run files with a <tt class="docutils literal"><span class="pre">.tmplt</span></tt> extension through Mako, using the
environment dictionary you pass to it.  Regular files just get copied.
You can specify owner, group, and permissions on a per-directory and
per-file basis using <tt class="docutils literal"><span class="pre">fck_metadata.txt</span></tt> files.  You can also have files
deleted from the target filesystem using <tt class="docutils literal"><span class="pre">fck_delete.txt</span></tt> files.</p>
</div>
<div class="section" id="git-repo-checkouts">
<h2>git repo checkouts<a class="headerlink" href="#git-repo-checkouts" title="Permalink to this headline">¶</a></h2>
<p>The Recipe class also defines some helper functions for working with git
repos.  You can checkout a git repo onto the remote machine, or check it
out locally and copy it to the remote machine if you don&#8217;t want to setup
the remote machine to be able to do checkouts.</p>
</div>
<div class="section" id="apply-process">
<h2>apply process<a class="headerlink" href="#apply-process" title="Permalink to this headline">¶</a></h2>
<p>Several things happen when you apply a recipe to a server.  There are
two class methods that get called during the apply process, and possibly
two messages that get displayed.  Generally you&#8217;ll just override the
apply method and sometimes add pre_apply or post_apply messages.  If you
override pre_apply_checks, remember to call the base class method.
Here&#8217;s the order that things happen in:</p>
<p>pre_apply_message -&gt; <tt class="docutils literal"><span class="pre">pre_apply_checks()</span></tt> -&gt; <tt class="docutils literal"><span class="pre">apply()</span></tt> -&gt; post_apply_message</p>
</div>
</div>
<div class="section" id="cookbooks">
<h1>Cookbooks<a class="headerlink" href="#cookbooks" title="Permalink to this headline">¶</a></h1>
<p>Cookbooks are ordered lists of recipes to apply to a server to create
systems made up of subsystems.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">frycook</span> <span class="kn">import</span> <span class="n">Cookbook</span>

<span class="kn">from</span> <span class="nn">recipes</span> <span class="kn">import</span> <span class="n">RecipeHosts</span>
<span class="kn">from</span> <span class="nn">recipes</span> <span class="kn">import</span> <span class="n">RecipeRootUser</span>
<span class="kn">from</span> <span class="nn">recipes</span> <span class="kn">import</span> <span class="n">RecipeShorewall</span>
<span class="kn">from</span> <span class="nn">recipes</span> <span class="kn">import</span> <span class="n">RecipeSSH</span>
<span class="kn">from</span> <span class="nn">recipes</span> <span class="kn">import</span> <span class="n">RecipeFail2ban</span>
<span class="kn">from</span> <span class="nn">recipes</span> <span class="kn">import</span> <span class="n">RecipePostfix</span>

<span class="k">class</span> <span class="nc">CookbookBase</span><span class="p">(</span><span class="n">Cookbook</span><span class="p">):</span>
    <span class="n">recipe_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">RecipeRootUser</span><span class="p">,</span>
                   <span class="n">RecipeHosts</span><span class="p">,</span>
                   <span class="n">RecipeShorewall</span><span class="p">,</span>
                   <span class="n">RecipeSSH</span><span class="p">,</span>
                   <span class="n">RecipeFail2ban</span><span class="p">,</span>
                   <span class="n">RecipePostfix</span><span class="p">]</span>
</pre></div>
</div>
<p>There should be a cookbook list in the <tt class="docutils literal"><span class="pre">__init__.py</span></tt> file for the
cookbooks packge.  This lists all the cookbooks available to the
frycooker.py program.</p>
<p>Here&#8217;s the <tt class="docutils literal"><span class="pre">__init__.py</span></tt> file for the sample cookbooks module:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">base</span> <span class="kn">import</span> <span class="n">CookbookBase</span>
<span class="kn">from</span> <span class="nn">web</span> <span class="kn">import</span> <span class="n">CookbookWeb</span>

<span class="n">cookbooks</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;base&#39;</span><span class="p">:</span> <span class="n">CookbookBase</span><span class="p">,</span>
    <span class="s">&#39;web&#39;</span><span class="p">:</span> <span class="n">CookbookWeb</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="packages-directory">
<h1>Packages Directory<a class="headerlink" href="#packages-directory" title="Permalink to this headline">¶</a></h1>
<p>The packages directory contains all the files needed by the recipes.
There is one sub-directory per package, and each package generally
corresponds to a recipe.  Within each package the directories and files
are laid out the exact same as they will be on the target systems.  Any
files with <tt class="docutils literal"><span class="pre">.tmplt</span></tt> extensions will be processed as mako templates
before being copied out to computers.  The <tt class="docutils literal"><span class="pre">fck_metadata.txt</span></tt> files
define the ownership and permissions for the files and directories when
they&#8217;re copied to the target system.  The <tt class="docutils literal"><span class="pre">fck_delete.txt</span></tt> files list
files that should be deleted in that directory on the target systems.</p>
<p>Here&#8217;s the packages directory layout from our sample globule:</p>
<div class="highlight-python"><pre>packages                 # directory for the package files
  example_com            # root for example_com package files
    etc                  # corresponds to /etc on the target server
      nginx              # corresponds to /etc/nginx on the target server
        sites-available  # corresponds to /etc/nginx/sites-available on the target server
          example.com    # corresponds to /etc/nginx/sites-available/example.com on the target server
  hosts                  # root for hosts package files
    etc                  # corresponds to /etc on the target server
      hostname.tmplt     # template that becomes /etc/hostname on the target server
      hosts.tmplt        # template that becomes /etc/hosts on the target server
  nginx                  # root for nginx package files
    etc                  # corresponds to /etc directory on the target server
      default            # corresponds to /etc/default directory on the target server
        nginx            # corresponds to /etc/default/nginx file on the target server
      nginx              # corresponds to /etc/nginx directory on target server
        nginx.conf       # corresponds to /etc/nginx/nginx.conf file on target server
        sites-available  # corresponds to /etc/nginx/sites-available directory on target server
          default        # corresponds to /etc/nginx/sites-available/default directory on target server
          fck_delete.txt # lists files to delete from /etc/nginx/sites-available on target server
    srv                  # corresponds to /srv directory on the target server
      www                # corresponds to /srv/www directory on the target server
        50x.html         # corresponds to /srv/www/50x.html file on target server
        index.html       # corresponds to /srv/www/index.html file on target server
  postfix                # root for postfix package files
    etc                  # corresponds to /etc directory on the target server
      aliases            # corresponds to /etc/aliases directory on the target server
      mailname.tmplt     # template that becomes /etc/mailname on the target server
      postfix            # corresponds to /etc/postfix directory on the target server
        main.cf.tmplt    # template that becomes /etc/postfix/main.cf on the target server
  shorewall              # root for shorewall package files
    etc                  # corresponds to /etc directory on the target server
      default            # corresponds to /etc/default directory on the target server
        shorewall        # corresponds to /etc/default/shorewall directory on the target server
      shorewall          # corresponds to /etc/shorewall directory on the target server
        interfaces.tmplt # template that becomes /etc/shorewall/interfaces on the target server
  ssh                    # root for ssh package files
    etc                  # corresponds to /etc directory on the target server
      ssh                # corresponds to /etc/ssh directory on the target server
        sshd_config      # corresponds to /etc/ssh/sshd_config directory on the target server</pre>
</div>
<div class="section" id="template-files">
<h2>template files<a class="headerlink" href="#template-files" title="Permalink to this headline">¶</a></h2>
<p>Template files have <tt class="docutils literal"><span class="pre">.tmplt</span></tt> extensions and are mako templates that are
prcoessed into their final form before being copied out to the
servers. They use the standard environment dictionary, plus any custom
dictionary entries prepared by the recipe.  Once processed, they are
copied with their filenames having having the <tt class="docutils literal"><span class="pre">.tmplt</span></tt> extension
removed.</p>
<p>Example:</p>
<div class="highlight-python"><pre>hosts.tmplt in package -&gt; hosts on server</pre>
</div>
</div>
<div class="section" id="fck-delete-txt-files">
<h2>fck_delete.txt files<a class="headerlink" href="#fck-delete-txt-files" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">fck_delete.txt</span></tt> files list other files that should be deleted from the
targe directories, one filename per line.  You would have a separate
<tt class="docutils literal"><span class="pre">fck_delete.txt</span></tt> file in each directory that you want files deleted
from.  The <tt class="docutils literal"><span class="pre">fck_delete.txt</span></tt> file itself is not copied.</p>
</div>
<div class="section" id="fck-metadata-txt-files">
<h2>fck_metadata.txt files<a class="headerlink" href="#fck-metadata-txt-files" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">fck_metadata.txt</span></tt> files list the ownership and permissions you can set
on files in the directories, one line per file and/or directory. The
<tt class="docutils literal"><span class="pre">fck_metadata.txt</span></tt> file itself is not copied.</p>
</div>
<div class="section" id="regular-files">
<h2>regular files<a class="headerlink" href="#regular-files" title="Permalink to this headline">¶</a></h2>
<p>Regular files are everything that&#8217;s not a template file,
<tt class="docutils literal"><span class="pre">fck_delete.txt</span></tt> file, or <tt class="docutils literal"><span class="pre">fck_metadata.txt</span></tt> file.  They are copied
verbatim to the server with no processing.</p>
</div>
</div>
<div class="section" id="settings">
<h1>Settings<a class="headerlink" href="#settings" title="Permalink to this headline">¶</a></h1>
<p>There are a few settings that frycook depends on.  They are read in from
a JSON file called <tt class="docutils literal"><span class="pre">settings.json</span></tt> and are passed around as a dictionary
to the constructors for Cookbooks and Recipes.  The settings dicionary
has the following keys:</p>
<p><tt class="docutils literal"><span class="pre">&quot;package_dir&quot;</span></tt>: root of the packages hierarchy for the file copying
routines to look in</p>
<p><tt class="docutils literal"><span class="pre">&quot;file_ignores&quot;</span></tt>: regex pattern for filenames to ignore while copying
package files</p>
<p>For any key containing the strings <tt class="docutils literal"><span class="pre">&quot;dir&quot;</span></tt> or <tt class="docutils literal"><span class="pre">&quot;path&quot;</span></tt>, if you include a
tilde <tt class="docutils literal"><span class="pre">~</span></tt> in the value, it will be replaced with the home directory of
the user running frycooker.p, just like in bash.  For this example, that
would be the <tt class="docutils literal"><span class="pre">&quot;package_dir&quot;</span></tt> key.</p>
<p>Example settings.json file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span>
    <span class="s">&quot;package_dir&quot;</span><span class="p">:</span> <span class="s">&quot;~/Dropbox/dev/frycook/sample/packages/&quot;</span><span class="p">,</span>
    <span class="s">&quot;file_ignores&quot;</span><span class="p">:</span> <span class="s">&quot;.*~&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="environment">
<h1>Environment<a class="headerlink" href="#environment" title="Permalink to this headline">¶</a></h1>
<p>Frycook depends on having detailed knowledge of the metadata needed by
all the components when software is being setup on the computers.  It is
read in from a set of files into a single dictionary that is passed
around to the parts of the frycook framework.  The environment
dictionary contains all the metadata about the computers and the
environment they live in that frycooker.py, the recipes, and the
cookbooks need to function.  Most of its data is directly relevant to
specific recipes and is filled in depending on the recipes&#8217; needs.  It&#8217;s
a dictionary with three main sections that should always be there:</p>
<p><tt class="docutils literal"><span class="pre">&quot;users&quot;</span></tt>: a list of the users that recipes could reference, with such
things as public ssh keys</p>
<p><tt class="docutils literal"><span class="pre">&quot;computers&quot;</span></tt>: a list of computers in the system, with such things as
ip addresses</p>
<p><tt class="docutils literal"><span class="pre">&quot;groups&quot;</span></tt>: groups of computers that will be addressed as a unit</p>
<p>Just like for the settings dictionary, any key containing <tt class="docutils literal"><span class="pre">&quot;dir&quot;</span></tt> or
<tt class="docutils literal"><span class="pre">&quot;path&quot;</span></tt> and including a tilde <tt class="docutils literal"><span class="pre">~</span></tt> in the value will have the tilde
replaced with the home directory of the user running frycooker.py.</p>
<p>Each computer in the <tt class="docutils literal"><span class="pre">&quot;computers&quot;</span></tt> section is also expected to have a
<tt class="docutils literal"><span class="pre">&quot;components&quot;</span></tt> section listing all the cookbooks and recipes that that
computer uses.  This is used by frycooker.py to easily apply all
relevant cookbooks and recipes to computers.  It&#8217;s also a good way to
keep track of what components make up that computer when it&#8217;s fully
functional.</p>
<p>Each component in the list has a <tt class="docutils literal"><span class="pre">&quot;type&quot;</span></tt> key identifying if it&#8217;s a
cookbook or a recipe, and a <tt class="docutils literal"><span class="pre">&quot;name&quot;</span></tt> key identifying the name of the
cookbook or recipe.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span>
    <span class="s">&quot;computers&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&quot;dev&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&quot;components&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s">&quot;name&quot;</span><span class="p">:</span> <span class="s">&quot;base&quot;</span><span class="p">,</span>
                    <span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="s">&quot;cookbook&quot;</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s">&quot;name&quot;</span><span class="p">:</span> <span class="s">&quot;web&quot;</span><span class="p">,</span>
                    <span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="s">&quot;cookbook&quot;</span>
                <span class="p">}</span>
            <span class="p">],</span>
            <span class="s">&quot;domain_name&quot;</span><span class="p">:</span> <span class="s">&quot;fubu.example&quot;</span><span class="p">,</span>
            <span class="s">&quot;host_group&quot;</span><span class="p">:</span> <span class="s">&quot;dev&quot;</span><span class="p">,</span>
            <span class="s">&quot;private_ifaces&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s">&quot;eth2&quot;</span>
            <span class="p">],</span>
            <span class="s">&quot;private_ips&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;192.168.1.126&quot;</span><span class="p">:</span> <span class="s">&quot;dev&quot;</span>
            <span class="p">},</span>
            <span class="s">&quot;public_ifaces&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s">&quot;eth0&quot;</span><span class="p">,</span>
                <span class="s">&quot;eth1&quot;</span>
            <span class="p">],</span>
            <span class="s">&quot;public_ips&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;192.168.56.10&quot;</span><span class="p">:</span> <span class="s">&quot;dev.fubu.example&quot;</span><span class="p">,</span>
                <span class="s">&quot;192.168.56.11&quot;</span><span class="p">:</span> <span class="s">&quot;dev.fubu.example&quot;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s">&quot;groups&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&quot;dev&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&quot;computers&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s">&quot;dev&quot;</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s">&quot;users&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&quot;example_com&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&quot;ssh_public_key&quot;</span><span class="p">:</span> <span class="s">&quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDYK8U9Isp+Ih+THCj2ohCo6nLY1R5Sn7oPzxM8ZBwH3ik/2EF3v0ibNezruja1I3OwF8W1QyWOdooIwTYJ8HXH9+Gyxcq/PseXbFWqg3k/lL50d5AawyRQZndOaNcFG6B8ULXJDksA6oQccXRzzxmnXpwGR8XEfSBCo2cdWDF1CXKvKXDZ4sqvGTVJIKshUAVbmfi4wH0LTtGIlV4IxslKUbfsErIU8kSyZNLLslq9XRvlqVK3iSabomKUY14MTbc3sefQzIctTtlmBpZw2mMBS49k4HYo1UwhUNiLbFBS7QhcivbJwFqGPj0N5pAx0oPUj1m96GGsqpiqu1eNp/yb jay@Jamess-MacBook-Air.local&quot;</span>
        <span class="p">},</span>
        <span class="s">&quot;root&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&quot;ssh_public_key&quot;</span><span class="p">:</span> <span class="s">&quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDYK8U9Isp+Ih+THCj2ohCo6nLY1R5Sn7oPzxM8ZBwH3ik/2EF3v0ibNezruja1I3OwF8W1QyWOdooIwTYJ8HXH9+Gyxcq/PseXbFWqg3k/lL50d5AawyRQZndOaNcFG6B8ULXJDksA6oQccXRzzxmnXpwGR8XEfSBCo2cdWDF1CXKvKXDZ4sqvGTVJIKshUAVbmfi4wH0LTtGIlV4IxslKUbfsErIU8kSyZNLLslq9XRvlqVK3iSabomKUY14MTbc3sefQzIctTtlmBpZw2mMBS49k4HYo1UwhUNiLbFBS7QhcivbJwFqGPj0N5pAx0oPUj1m96GGsqpiqu1eNp/yb jay@Jamess-MacBook-Air.local&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This dictionary is created by processing the environment JSON files.
The main file is called <tt class="docutils literal"><span class="pre">environment.json</span></tt>, and it can have include
directives that pull in additonal json files so that you can split up
large environments into multiple files.</p>
<p>environment.json:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span>
  <span class="s">&quot;users&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s">&quot;root&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s">&quot;ssh_public_key&quot;</span><span class="p">:</span> <span class="s">&quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDYK8U9Isp+Ih+THCj2ohCo6nLY1R5Sn7oPzxM8ZBwH3ik/2EF3v0ibNezruja1I3OwF8W1QyWOdooIwTYJ8HXH9+Gyxcq/PseXbFWqg3k/lL50d5AawyRQZndOaNcFG6B8ULXJDksA6oQccXRzzxmnXpwGR8XEfSBCo2cdWDF1CXKvKXDZ4sqvGTVJIKshUAVbmfi4wH0LTtGIlV4IxslKUbfsErIU8kSyZNLLslq9XRvlqVK3iSabomKUY14MTbc3sefQzIctTtlmBpZw2mMBS49k4HYo1UwhUNiLbFBS7QhcivbJwFqGPj0N5pAx0oPUj1m96GGsqpiqu1eNp/yb jay@Jamess-MacBook-Air.local&quot;</span>
    <span class="p">},</span>
    <span class="s">&quot;example_com&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s">&quot;ssh_public_key&quot;</span><span class="p">:</span> <span class="s">&quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDYK8U9Isp+Ih+THCj2ohCo6nLY1R5Sn7oPzxM8ZBwH3ik/2EF3v0ibNezruja1I3OwF8W1QyWOdooIwTYJ8HXH9+Gyxcq/PseXbFWqg3k/lL50d5AawyRQZndOaNcFG6B8ULXJDksA6oQccXRzzxmnXpwGR8XEfSBCo2cdWDF1CXKvKXDZ4sqvGTVJIKshUAVbmfi4wH0LTtGIlV4IxslKUbfsErIU8kSyZNLLslq9XRvlqVK3iSabomKUY14MTbc3sefQzIctTtlmBpZw2mMBS49k4HYo1UwhUNiLbFBS7QhcivbJwFqGPj0N5pAx0oPUj1m96GGsqpiqu1eNp/yb jay@Jamess-MacBook-Air.local&quot;</span>
    <span class="p">}</span>
  <span class="p">},</span>

  <span class="s">&quot;computers&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s">&quot;imports&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;comp_dev.json&quot;</span><span class="p">]</span>
  <span class="p">},</span>

  <span class="s">&quot;groups&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s">&quot;dev&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="s">&quot;computers&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;dev&quot;</span><span class="p">]</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>comp_dev.json:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span>
  <span class="s">&quot;dev&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s">&quot;domain_name&quot;</span><span class="p">:</span> <span class="s">&quot;fubu.example&quot;</span><span class="p">,</span>
    <span class="s">&quot;host_group&quot;</span><span class="p">:</span> <span class="s">&quot;dev&quot;</span><span class="p">,</span>
    <span class="s">&quot;public_ifaces&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;eth0&quot;</span><span class="p">,</span> <span class="s">&quot;eth1&quot;</span><span class="p">],</span>
    <span class="s">&quot;public_ips&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s">&quot;192.168.56.10&quot;</span><span class="p">:</span> <span class="s">&quot;dev.fubu.example&quot;</span><span class="p">,</span>
                   <span class="s">&quot;192.168.56.11&quot;</span><span class="p">:</span> <span class="s">&quot;dev.fubu.example&quot;</span><span class="p">},</span>
    <span class="s">&quot;private_ifaces&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;eth2&quot;</span><span class="p">],</span>
    <span class="s">&quot;private_ips&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s">&quot;192.168.1.126&quot;</span><span class="p">:</span> <span class="s">&quot;dev&quot;</span><span class="p">},</span>
    <span class="s">&quot;components&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="s">&quot;cookbook&quot;</span><span class="p">,</span> <span class="s">&quot;name&quot;</span><span class="p">:</span> <span class="s">&quot;base&quot;</span><span class="p">},</span>
                   <span class="p">{</span><span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="s">&quot;cookbook&quot;</span><span class="p">,</span> <span class="s">&quot;name&quot;</span><span class="p">:</span> <span class="s">&quot;web&quot;</span><span class="p">}]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="frycooker-py">
<h1>Frycooker.py<a class="headerlink" href="#frycooker-py" title="Permalink to this headline">¶</a></h1>
<p>Frycooker.py is the program that takes all your carefully coded recipes
and cookbooks and applies them to computers.</p>
<p>The recipes and cookbooks modules should be accessible via the
<tt class="docutils literal"><span class="pre">PYTHONPATH</span></tt> so they can be imported.  In the sample globule we ensure
this with the <tt class="docutils literal"><span class="pre">runner.sh</span></tt> wrapper script which sets up the python
path, then invokes frycooker.py:</p>
<div class="highlight-python"><pre>#!/bin/bash

export PYTHONPATH=.
frycooker.py $*</pre>
</div>
<div class="section" id="recipes-and-cookbooks-vs-apply">
<h2>recipes and cookbooks vs. apply<a class="headerlink" href="#recipes-and-cookbooks-vs-apply" title="Permalink to this headline">¶</a></h2>
<p>There are two ways to update computers.  The first way is to specify
recipes and cookbooks on the frycooker.py command line (using the &#8216;-r&#8217;
and &#8216;-c&#8217; command-line options) and have those be applied to all the
desired computers, in the order that they&#8217;re specified.  This way is
nice to use when you have specific, small changes to apply.</p>
<p>The second way to update a computer is to use the <em>apply</em> option in
frycooker.py (&#8216;-a&#8217; command-line option).  With this option frycooker.py
looks at the <tt class="docutils literal"><span class="pre">&quot;components&quot;</span></tt> list in the environment for each specified
computer to determine what recipes and cookbooks apply to each computer,
then applies them.  This way is nice to use when you just want to bring
a computer into compliance with all of its components and don&#8217;t want to
have to figure out which ones have changed and apply them individually.
This is when the idempotence of your recipes comes in handy because it
allows you to blindly update computers without worrying if the indicated
changes have already been applied.</p>
</div>
<div class="section" id="computers-vs-groups">
<h2>computers vs. groups<a class="headerlink" href="#computers-vs-groups" title="Permalink to this headline">¶</a></h2>
<p>When choosing which computers to run frycook against, you have the
option of giving a list of computers or of specifying a group and having
frycooker.py run against all computers in that group.  Groups are
specified in the <tt class="docutils literal"><span class="pre">&quot;groups&quot;</span></tt> key in the environment json files.
Frycooker.py will use any combination of groups and computers that are
specified on its command line.  If there are identically named computers
and groups, the computer will be selected instead of the group.</p>
</div>
<div class="section" id="messages">
<h2>messages<a class="headerlink" href="#messages" title="Permalink to this headline">¶</a></h2>
<p>Messages are text string that are printed out to the end-user of
frycooker.py either before or after a recipe or cookbook is run.
Frycooker.py agregates all message for the run and prints all the
pre-apply messages before anything is run and all the post-apply
messages after everything else has been run.  If you&#8217;re curious as to
what messages a frycooker.py run will print, you can tell it to just
print the messages for you without applying any of the recipes or
cookbooks.</p>
</div>
<div class="section" id="dry-run">
<h2>dry run<a class="headerlink" href="#dry-run" title="Permalink to this headline">¶</a></h2>
<p>You can do a dry run with frycooker.py to see what the final environment
dictionary will look like and what all computers things will be applied
to.  This is especially nice when you have lots of <tt class="docutils literal"><span class="pre">import</span></tt> directives
in your environment json files, or if you are applying things to a group
of machines.  This way you know how the environment imports are handled
and which computers frycooker.py thinks are in the group.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Intro</a></li>
<li><a class="reference internal" href="#setup">Setup</a></li>
<li><a class="reference internal" href="#globules">Globules</a></li>
<li><a class="reference internal" href="#recipes">Recipes</a><ul>
<li><a class="reference internal" href="#example-recipe">example recipe</a></li>
<li><a class="reference internal" href="#recipe-list">recipe list</a></li>
<li><a class="reference internal" href="#idempotence">idempotence</a></li>
<li><a class="reference internal" href="#rudeness">rudeness</a></li>
<li><a class="reference internal" href="#file-set-copying">file set copying</a></li>
<li><a class="reference internal" href="#git-repo-checkouts">git repo checkouts</a></li>
<li><a class="reference internal" href="#apply-process">apply process</a></li>
</ul>
</li>
<li><a class="reference internal" href="#cookbooks">Cookbooks</a></li>
<li><a class="reference internal" href="#packages-directory">Packages Directory</a><ul>
<li><a class="reference internal" href="#template-files">template files</a></li>
<li><a class="reference internal" href="#fck-delete-txt-files">fck_delete.txt files</a></li>
<li><a class="reference internal" href="#fck-metadata-txt-files">fck_metadata.txt files</a></li>
<li><a class="reference internal" href="#regular-files">regular files</a></li>
</ul>
</li>
<li><a class="reference internal" href="#settings">Settings</a></li>
<li><a class="reference internal" href="#environment">Environment</a></li>
<li><a class="reference internal" href="#frycooker-py">Frycooker.py</a><ul>
<li><a class="reference internal" href="#recipes-and-cookbooks-vs-apply">recipes and cookbooks vs. apply</a></li>
<li><a class="reference internal" href="#computers-vs-groups">computers vs. groups</a></li>
<li><a class="reference internal" href="#messages">messages</a></li>
<li><a class="reference internal" href="#dry-run">dry run</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Welcome to Frycook!</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="tutorial.html"
                        title="next chapter">Intro</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/instructions.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="tutorial.html" title="Intro"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Welcome to Frycook!"
             >previous</a> |</li>
        <li><a href="index.html">Frycook 0.3.7 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, James Yates Farrimond.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>